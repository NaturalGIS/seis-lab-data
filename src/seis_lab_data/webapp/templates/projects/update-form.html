{% import "macros.html" as macros %}
<form>
    {{ macros.render_localizable_field(form.name) }}
    {{ macros.render_localizable_field(form.description) }}
    {{ macros.render_form_field(form.root_path) }}

    <div
            class="row"
            data-signals:bbox.min-lon="{{ form.bounding_box.min_lon.data }}"
            data-signals:bbox.max-lon="{{ form.bounding_box.max_lon.data }}"
            data-signals:bbox.min-lat="{{ form.bounding_box.min_lat.data }}"
            data-signals:bbox.max-lat="{{ form.bounding_box.max_lat.data }}"
    >
        <div class="col">
            <bbox-map
                    data-tile-url="{{ settings.webmap_base_tile_layer_url }}"
                    data-center-lon="{{ form.bounding_box.min_lon.data }}"
                    data-center-lat="{{ form.bounding_box.min_lat.data }}"
                    data-zoom="{{ settings.webmap_default_zoom_level }}"
                    data-min-lat=""
                    data-min-lon=""
                    data-max-lat=""
                    data-max-lon=""
                    data-attr:data-min-lat="$bbox.minLat"
                    data-attr:data-min-lon="$bbox.minLon"
                    data-attr:data-max-lat="$bbox.maxLat"
                    data-attr:data-max-lon="$bbox.maxLon"
                    style="display: block; width: 100%; height: 30vh"
                    data-on:bbox-changed="$bbox = evt.detail.bbox"
            ></bbox-map>
        </div>
    </div>
    {{ macros.render_form_field(form.bounding_box.min_lon, data_bind="bbox.minLon") }}
    {{ macros.render_form_field(form.bounding_box.max_lon, data_bind="bbox.maxLon") }}
    {{ macros.render_form_field(form.bounding_box.min_lat, data_bind="bbox.minLat") }}
    {{ macros.render_form_field(form.bounding_box.max_lat, data_bind="bbox.maxLat") }}

    <h3>{{ _("Links") }}</h3>
    {{ macros.render_links_fields(
        form.links,
        url_for("projects:add_update_form_link", project_id=project.id),
        url_for("projects:remove_update_form_link", project_id=project.id),
        form.csrf_token.current_token
    ) }}

    <div class="row mb-3">
        <div class="col-sm-10 offset-sm-2">
            <button
                    type="reset"
                    class="btn btn-outline-secondary"
                    data-on:click="@get('{{ url_for("projects:get_details_component", project_id=project.id) }}')"
                    aria-label="cancel-update"
            >{{ _('cancel') | capitalize }}
            </button>
            <button
                    type="submit"
                    aria-label="submit-update-form"
                    class="btn btn-primary"
                    data-on:click="@put('{{ url_for('projects:detail', project_id=project.id) }}', {
                            contentType: 'form',
                            headers: {'X-CSRFToken': '{{ form.csrf_token.current_token }}'}
                        })"
                    data-indicator="updating"
                    data-attr:disabled="$updating"
                    data-text="$updating ? '{{ _('updating project...') | capitalize }}' : '{{ _('update project') | capitalize }}'"
            >
            </button>
            <div class="spinner-border spinner-border-sm ms-3" role="status" aria-hidden="true"
                 data-attr:hidden="!$updating">
                <span class="visually-hidden">{{ _("loading...") | capitalize }}</span>
            </div>
        </div>
    </div>
</form>
