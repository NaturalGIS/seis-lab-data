{% import "macros.html" as macros %}
<form data-on:datastar-fetch="evt.detail.type === 'finished' && document.querySelector('bbox-map')?.initMap()">
    {{ macros.render_localizable_field(form.name) }}
    {{ macros.render_localizable_field(form.description) }}

    {{ macros.render_form_field(form.root_path) }}

    <div
            class="row"
            data-signals:bbox.min-lon="{{ form.bounding_box.min_lon | int }}"
            data-signals:bbox.max-lon="{{ form.bounding_box.max_lon | int }}"
            data-signals:bbox.min-lat="{{ form.bounding_box.min_lat | int }}"
            data-signals:bbox.max-lat="{{ form.bounding_box.max_lat | int }}"
    >
        <div class="col">
            <h3>{{ _('spatial extent') }}</h3>
            <bbox-map
                    data-tile-url="{{ settings.webmap_base_tile_layer_url }}"
                    data-center-lon="{{ settings.webmap_default_center_lon }}"
                    data-center-lat="{{ settings.webmap_default_center_lat }}"
                    data-zoom="{{ settings.webmap_default_zoom_level }}"
                    data-min-lat=""
                    data-min-lon=""
                    data-max-lat=""
                    data-max-lon=""
                    data-attr:data-min-lat="$bbox.minLat"
                    data-attr:data-min-lon="$bbox.minLon"
                    data-attr:data-max-lat="$bbox.maxLat"
                    data-attr:data-max-lon="$bbox.maxLon"
                    style="display: block; width: 100%; height: 30vh"
                    data-on:bbox-changed="$bbox = evt.detail.bbox"
            ></bbox-map>
        </div>
    </div>
    {{ macros.render_form_field(form.bounding_box.min_lon, data_bind="bbox.minLon") }}
    {{ macros.render_form_field(form.bounding_box.max_lon, data_bind="bbox.maxLon") }}
    {{ macros.render_form_field(form.bounding_box.min_lat, data_bind="bbox.minLat") }}
    {{ macros.render_form_field(form.bounding_box.max_lat, data_bind="bbox.maxLat") }}


    <h3 data-signals="{nextIndex: {{ form.links|length }}}">{{ _("Links") }}</h3>
    {{ macros.render_links_fields(
        form.links,
        url_for("projects:add_form_link"),
        url_for("projects:remove_form_link"),
        form.csrf_token.current_token
    ) }}

    <div class="row mb-3">
        <div class="col-sm-10 offset-sm-2">
            <button
                    type="reset"
                    class="btn btn-outline-secondary"
                    data-on:click="@get('{{ url_for("projects:list") }}')"
                    aria-label="cancel-creation"
            >{{ _('cancel') | capitalize }}
            </button>
            <button
                    type="submit"
                    aria-label="submit-create-form"
                    class="btn btn-primary"
                    data-on:click="@post('{{ url_for('projects:list') }}', {
                            contentType: 'form',
                            headers: {'X-CSRFToken': '{{ form.csrf_token.current_token }}'}
                        })"
                    data-indicator="posting"
                    data-attr:disabled="$posting"
                    data-text="$posting ? '{{ _('Creating project...') }}' : '{{ _('Create project') }}'"
            >
            </button>
            <div class="spinner-border spinner-border-sm ms-3" role="status" aria-hidden="true"
                 data-attr:hidden="!$posting">
                <span class="visually-hidden">{{ _("Loading...") }}</span>
            </div>
        </div>
    </div>
</form>
