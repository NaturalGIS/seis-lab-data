{% import "macros.html" as macros %}
<form>
    {{ macros.render_localizable_field(form.name) }}
    {{ macros.render_localizable_field(form.description) }}
    {{ macros.render_form_field(form.relative_path) }}
    {{ macros.render_form_field(form.dataset_category_id) }}
    {{ macros.render_form_field(form.domain_type_id) }}
    {{ macros.render_form_field(form.workflow_stage_id) }}

    <h3>{{ _("links") | capitalize }}</h3>
    {{ macros.render_links_fields(
        form.links,
        url_for("survey_related_records:add_update_form_link", survey_related_record_id=survey_related_record.id),
        url_for("survey_related_records:remove_update_form_link", survey_related_record_id=survey_related_record.id),
        form.csrf_token.current_token
    ) }}

    <h3>{{ _("assets") | capitalize }}</h3>
    <div class="row border p-4 mb-3">
        <div id="form-assets-container" class="col">
            {% for asset in form.assets %}
                <h4>{{ _("asset") | capitalize }} {{ loop.index0 + 1 }}</h4>
                {{ macros.render_localizable_field(asset.asset_name, "asset-") }}
                {{ macros.render_localizable_field(asset.asset_description, "asset-") }}
                {{ macros.render_form_field(asset.relative_path, "asset-") }}
                <h5>{{ _("asset links") | capitalize }}</h5>
                {{ macros.render_links_fields(
                    asset.asset_links,
                    url_for("survey_related_records:add_update_form_asset_link", survey_related_record_id=survey_related_record.id, asset_index=loop.index0),
                    url_for("survey_related_records:remove_update_form_asset_link", survey_related_record_id=survey_related_record.id, asset_index=loop.index0),
                    form.csrf_token.current_token,
                    "asset-" ~ loop.index0 ~ "-"
                ) }}

                <button
                        type="submit"
                        class="btn btn-outline-danger"
                        data-on-click="@post('{{ url_for("survey_related_records:remove_update_form_asset", survey_related_record_id=survey_related_record.id) }}?asset_index={{ loop.index0 }}', {
                  contentType: 'form',
                  headers: {'X-CSRFToken': '{{ form.csrf_token.current_token }}'},
                })"
                >{{ _("remove asset") | capitalize }}</button>
            {% endfor %}
        </div>
        <div class="row">
            <div class="col">
                <button
                        type="button"
                        class="btn btn-outline-secondary"
                        aria-label="add-another-asset"
                        data-on-click="@post('{{ url_for("survey_related_records:add_update_form_asset", survey_related_record_id=survey_related_record.id) }}', {
          contentType: 'form',
          headers: {'X-CSRFToken': '{{ form.csrf_token.current_token }}'},
        })"
                >
                    {{ _("add another asset") | capitalize }}
                </button>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-sm-10 offset-sm-2">
            <button
                    type="reset"
                    class="btn btn-outline-secondary"
                    data-on-click="@get('{{ url_for("survey_related_records:get_details_component", survey_related_record_id=survey_related_record.id) }}')"
                    aria-label="cancel-update"
            >{{ _('cancel') | capitalize }}
            </button>
            <button
                    type="submit"
                    aria-label="submit-create-form"
                    class="btn btn-primary"
                    data-on-click="@post('{{ url_for('survey_related_records:detail', survey_related_record_id=survey_related_record.id) }}', {
                            contentType: 'form',
                            headers: {'X-CSRFToken': '{{ form.csrf_token.current_token }}'}
                        })"
                    data-indicator="posting"
                    data-attr-disabled="$posting"
                    data-text="$posting ? '{{ _('Updating survey-related record...') }}' : '{{ _('Update survey-related record') }}'"
            >
            </button>
            <div class="spinner-border spinner-border-sm ms-3" role="status" aria-hidden="true"
                 data-attr-hidden="!$posting">
                <span class="visually-hidden">{{ _("Loading...") }}</span>
            </div>
        </div>
    </div>
</form>
